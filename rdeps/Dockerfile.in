# DO NOT EDIT FILES CALLED 'Dockerfile'; they are automatically
# generated. Edit 'Dockerfile.in' and generate the 'Dockerfile'
# with the 'rake' command.

# The suggested name for this image is: <%= image_name %>.

FROM <%= parent %>

MAINTAINER dtenenba@fredhutch.org

RUN DEBIAN_FRONTEND=noninteractive \
    apt-get update -qq && apt-get dist-upgrade -y

RUN DEBIAN_FRONTEND=noninteractive \ 
    apt-get build-dep -y r-base

RUN DEBIAN_FRONTEND=noninteractive \
    apt-get install -y \
    biber \
    curl \
    dh-autoreconf \
    dvipng \
    gdb \
    gdebi-core \
    libarchive-zip-perl \
    libcurl4-openssl-dev \
    libdbd-mysql-perl \
    libdbi-perl \
    libhdf5-dev \
    libmpich2-dev \
    libnetcdf-dev \
    libopenmpi-dev \
    libopenmpi1.6 \
    libqt4-opengl-dev \
    libxml2-dev \
    mpich2 \
    openmpi-bin \
    openmpi-checkpoint \
    openmpi-common \
    pandoc \
    python-pip \
    texlive-science \
    valgrind

RUN pip install -U awscli

# will this link expire? can ADD follow redirects?
ADD https://s3.amazonaws.com/github-cloud/releases/23357588/0a2433bc-5a29-11e4-8e74-fbea8721fcc7.gz?response-content-disposition=attachment%3B%20filename%3Dprotobuf-2.6.1.tar.gz&response-content-type=application/octet-stream&AWSAccessKeyId=AKIAISTNZFOVBIJMK3TQ&Expires=1419370092&Signature=drjozraupY%2FlH9%2FVmewq%2BcXFU8w%3D /tmp/protobuf-2.6.1.tar.gz

RUN cd /tmp/R-source && \
    tar -zxf /tmp/protobuf-2.6.1.tar.gz && \
    rm protobuf-2.6.1.tar.gz && \
    cd protobuf-2.6.1 && \
    ./autogen.sh && \
    ./configure && \
    make && \
    make install
