# DO NOT EDIT FILES CALLED 'Dockerfile'; they are automatically
# generated. Edit 'Dockerfile.in' and generate the 'Dockerfile'
# with the 'rake' command.

# The suggested name for this image is: <%= image_name %>.

FROM <%= parent %>

MAINTAINER dtenenba@fredhutch.org

# temporarily block dist-upgrade:
#    DEBIAN_FRONTEND=noninteractive apt-get dist-upgrade -y && \


RUN DEBIAN_FRONT_END=noninteractive apt-get install -y --force-yes libfreetype6=2.5.2-3

RUN DEBIAN_FRONTEND=noninteractive apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y \
    libexpat1-dev \
    libgmp3-dev \
    libnetcdf-dev \
    libopenbabel-dev \
    libgl1-mesa-dev \
    libglu1-mesa-dev \
    libgsl0-dev \
    libgsl0ldbl \
    openjdk-8-jdk

<% if is_devel %>
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y \
    libbz2-dev liblzma-dev libpcre3-dev libpng12-dev 

<% end %>

RUN R CMD javareconf

ENV NETCDF_INCLUDE=/usr/include

ADD startx.sh /tmp/


ADD installFromBiocViews.R /tmp/

# invalidates cache every 24 hours
ADD http://master.bioconductor.org/todays-date /tmp/


RUN cd /tmp && \
    ./startx.sh && \
    export DISPLAY=:1.0 && \
    R -f /tmp/installFromBiocViews.R
